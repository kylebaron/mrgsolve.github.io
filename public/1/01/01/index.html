









<div id="output-html_document" class="section level2">
<h2>‘— ##’ output: html_document</h2>
</div>
<div id="title" class="section level2">
<h2>‘title: “” ##’ —</h2>
</div>
<div id="section" class="section level2">
<h2>‘<BR> ##’</h2>
</div>
<div id="flexible-heterogeneous-simulation-designs-in-a-population" class="section level2">
<h2>‘##’ # Flexible, heterogeneous simulation designs in a population</h2>
</div>
<div id="section-1" class="section level2">
<h2>‘##’</h2>
</div>
<div id="section-2" class="section level2">
<h2>’</h2>
</div>
<div id="design-lists-help-you-assign-different-designs-to" class="section level2">
<h2>‘##’ Design lists help you assign different designs to</h2>
</div>
<div id="different-groups-in-a-population-or-specific-designs-to-specific-individuals." class="section level2">
<h2>‘different groups in a population or specific ##’ designs to specific individuals.</h2>
</div>
<div id="messagefalse" class="section level1">
<h1>+ message=FALSE</h1>
<p>library(mrgsolve) library(dplyr) knitr::opts_chunk$set(comment=‘.’) #+</p>
<div id="assign-designs-to-individuals" class="section level2">
<h2>‘### Assign designs to individuals ##’</h2>
</div>
<div id="to-illustrate-lets-make-a-population-of-4-individuals-all-with-different-simulation-end-times." class="section level2">
<h2>‘To illustrate, let’s make a population of ##’ 4 individuals, all with different simulation <strong>end</strong> times.</h2>
</div>
<div id="section-3" class="section level2">
<h2>‘##’</h2>
<p>des &lt;- data_frame(ID=1:4, end=seq(24,96,24)) #+ des</p>
</div>
<div id="for-simplicity-we-will-only-vary-the-simulation-end-time-in" class="section level2">
<h2>‘##’ For simplicity, we will only vary the simulation end time in</h2>
</div>
<div id="this-example.-see-later-examples-where-start-delta-and-add-can-varied-as-well." class="section level2">
<h2>‘this example. See later examples where <code>start</code>, <code>delta</code> and ##’ <code>add</code> can varied as well.</h2>
</div>
<div id="we-can-turn-this-in-to-a-list-of-designs-with-as_deslist." class="section level2">
<h2>‘##’ We can turn this in to a list of designs with <code>as_deslist</code>.</h2>
</div>
<div id="section-4" class="section level2">
<h2>‘##’</h2>
<p>as_deslist(des, descol=“ID”)</p>
</div>
<div id="as_deslist-returns-one-design-for-each-individual-one" class="section level2">
<h2>‘##’ <code>as_deslist</code> returns one design for each individual, one</h2>
</div>
<div id="for-each-unique-level-of-descol.-the-deslist-is-a-list-of-tgrid-objects-see-tgrid." class="section level2">
<h2>‘for each unique level of <code>descol</code>. The ##’ deslist is a list of <code>tgrid</code> objects (see <code>?tgrid</code>).</h2>
</div>
<div id="note-also-that-descol-is-retained-as-an-attribute-to-be-used-later." class="section level2">
<h2>‘Note also that <code>descol</code> is retained as an attribute to be used ##’ later.</h2>
</div>
<div id="lets-set-up-a-simulation-that-includes-these-4-ids" class="section level2">
<h2>‘##’ Let’s set up a simulation that includes these 4 IDs;</h2>
</div>
<div id="we-load-a-model-and-importantly-set-up-an-idata_set-for-the-simulation-that-includes-all-4-ids-in-the-design-list." class="section level2">
<h2>‘we load a model and, importantly, set up an <code>idata_set</code> ##’ for the simulation that includes all 4 IDs in the design list.</h2>
</div>
<div id="section-5" class="section level2">
<h2>’</h2>
<p>mod &lt;- mrgsolve:::house() %&gt;% ev(amt=100) #+ idata &lt;- select(des,ID) idata #+ des1 &lt;- as_deslist(des,“ID”)</p>
</div>
<div id="when-we-run-the-simulation-pass-in-the" class="section level2">
<h2>‘##’ When we run the simulation, pass in the</h2>
</div>
<div id="design-list-to-design-in-the-pipeline" class="section level2">
<h2>‘design list to <code>design</code> in the pipeline ##’</h2>
<p>out &lt;- mod %&gt;% idata_set(idata) %&gt;% design(des1) %&gt;% mrgsim</p>
</div>
<div id="we-see-that-id-1-has-a-24-hour-end-time-id-2-has-48-hour-simulation-time-id-3-with-72-hour" class="section level2">
<h2>‘We see that ID 1 has a 24 hour end time, ID 2 ##’ has 48 hour simulation time, ID 3 with 72 hour</h2>
</div>
<div id="simulation-time-and-id-4-96-hour-simulation-time-as-reflected-in-the-list-of-the-designs." class="section level2">
<h2>‘simulation time, and ID 4 96 hour simulation time ##’ as reflected in the list of the designs.</h2>
</div>
</div>
<div id="section-6" class="section level1">
<h1>+</h1>
<p>plot(out, CP~time|ID)</p>
<div id="note-check-the-arguments-to-design-design.-there" class="section level2">
<h2>‘##’ <strong>Note</strong>: Check the arguments to <code>design</code> (<code>?design</code>). There</h2>
</div>
<div id="is-a-descol-argument-that-is-required.-descol-in-this-function-refers-to-a-column-in-idata_set-to-be-used-as-the-grouping-variable" class="section level2">
<h2>‘is a <code>descol</code> argument that is required. <code>descol</code> in this function ##’ refers to a column in <code>idata_set</code> to be used as the grouping variable</h2>
</div>
<div id="to-assign-the-sampling-design.-as_deslist-also-had-a-descol-argument-that-referred-to-a-column-in-the-input-data-frame" class="section level2">
<h2>‘to assign the sampling design. <code>as_deslist</code> also had a <code>descol</code> ##’ argument that referred to a column in the input data frame</h2>
</div>
<div id="for-that-function.-we-dont-need-to-pass-descol-to-design-because-we-created-the-design-list-with-as_deslist-design" class="section level2">
<h2>‘for that function. We don’t need to pass <code>descol</code> to <code>design()</code> ##’ because we created the design list with <code>as_deslist</code>: <code>design()</code></h2>
</div>
<div id="reads-descol-from-the-attribute.-we-dont-have-to-use-as_deslist-to-create-the-design-list.-it-could-be-just-a" class="section level2">
<h2>‘reads <code>descol</code> from the attribute. We don’t <strong>have</strong> to ##’ use <code>as_deslist</code> to create the design list. It could be just a</h2>
</div>
<div id="plan-old-r-list-created-by-you-with-tgrid-objects.-in-that-case-you-must-state-what-descol-is-when-you-call-design." class="section level2">
<h2>‘plan old <code>R</code> list created by you with <code>tgrid</code> objects. In that ##’ case, you must state what <code>descol</code> is when you call <code>design()</code>.</h2>
</div>
<div id="and-it-cant-be-emphasized-enough-here-that-you-must-use-an-idata_set-for-this-to-work-and-idata_set-must" class="section level2">
<h2>‘And it can’t be emphasized enough here that you <strong>MUST</strong> use ##’ an <code>idata_set</code> for this to work and <code>idata_set</code> must</h2>
</div>
<div id="contain-a-valid-descol." class="section level2">
<h2>‘contain a valid <code>descol</code>.<br />
##’</h2>
</div>
<div id="assign-designs-to-treatment-arms-or-groups" class="section level2">
<h2>‘##’ ### Assign designs to treatment arms or groups</h2>
</div>
<div id="now-lets-simulate-a-trial-with-5-patients-in-each-of" class="section level2">
<h2>‘##’ Now, let’s simulate a trial with 5 patients in each of</h2>
</div>
<div id="treatment-arms.-in-this-trial-arm-1-lasts-24-hours-arm-2-last-48-hours-etc.-but" class="section level2">
<h2>‘4 treatment arms. In this trial, ##’ arm 1 lasts 24 hours, arm 2 last 48 hours … etc. But</h2>
</div>
<div id="every-patient-with-the-arm-1-indicator-will-get-simulated-for-24-hours-every-patient-with-arm-2-indicator-will-get-simulated" class="section level2">
<h2>‘every patient with the arm 1 indicator will get simulated ##’ for 24 hours, every patient with arm 2 indicator will get simulated</h2>
</div>
<div id="for-48-hours-and-so-on." class="section level2">
<h2>‘for 48 hours and so on. ##’</h2>
<p>idata &lt;- expand.idata(ARM=1:4,ID=1:5) #+ head(idata)</p>
</div>
<div id="now-lets-setup-the-designs-based-on-arm-rather" class="section level2">
<h2>‘##’ Now, let’s setup the designs based on <code>ARM</code> rather</h2>
</div>
<div id="than-id" class="section level2">
<h2>‘than <code>ID</code> ##’</h2>
<p>des &lt;- distinct(idata,ARM) %&gt;% mutate(end=seq(24,96,24)) #+ des</p>
</div>
<div id="the-simulation-works-the-same-way" class="section level2">
<h2>‘##’ The simulation works the same way</h2>
</div>
<div id="section-7" class="section level2">
<h2>’</h2>
<p>set.seed(11) #+ out &lt;- mod %&gt;% idata_set(idata) %&gt;% omat(dmat(1,1,1,1)/10) %&gt;% design(as_deslist(des,“ARM”)) %&gt;% mrgsim(carry.out=“ARM”)</p>
</div>
</div>
<div id="section-8" class="section level1">
<h1>+</h1>
<p>plot(out, CP~time|factor(ARM)) #+ plot(out, CP~time|factor(ID))</p>
<div id="list-cols-and-additional-times" class="section level2">
<h2>‘##’ ### <code>list-cols</code> and <code>additional</code> times</h2>
</div>
<div id="hopefully-its-clear-that-columns-named" class="section level2">
<h2>‘##’ Hopefully it’s clear that columns named</h2>
</div>
<div id="start-end-and-delta-in-the-the-input-data-frame-passed-to-as_deslist" class="section level2">
<h2>‘<code>start</code>, <code>end</code>, and <code>delta</code> in the ##’ the input data frame passed to <code>as_deslist</code></h2>
</div>
<div id="are-just-numeric-values-that-form-the-time-grid-object-see-tgrid." class="section level2">
<h2>‘are just numeric values that form ##’ the time grid object (see <code>?tgrid</code>).</h2>
</div>
<div id="what-about-add-the-vector-of-ad-hoc-times" class="section level2">
<h2>‘##’ What about <code>add</code>, the vector of ad-hoc times</h2>
</div>
<div id="for-the-simulation-these-too-can-be-accommodated-with-a-list-col-column-in" class="section level2">
<h2>‘for the simulation? These, too, can be ##’ accommodated with a <code>list-col</code> column in</h2>
</div>
<div id="the-input-data-frame.-note-that-list-cols-are-only-really-supported-in-specialized" class="section level2">
<h2>‘the input data frame. Note that <code>list-cols</code> ##’ are only really supported in specialized</h2>
</div>
<div id="tibble-type-data-frames." class="section level2">
<h2>‘<code>tibble</code> type data frames. ##’</h2>
</div>
<div id="these-are-random-times-for-ids-1-and-2" class="section level2">
<h2>‘##’ These are random times for IDs 1 and 2</h2>
<p>set.seed(12) t1 &lt;- c(0,sample(1:24,12)) t2 &lt;- c(0,sample(1:96,12)) #+ t1 t2</p>
</div>
<div id="note-when-we-simulate-with-end-0-mrgsolve" class="section level2">
<h2>‘##’ <strong>Note</strong>: When we simulate with <code>end &lt; 0</code>, <code>mrgsolve</code></h2>
</div>
<div id="knows-to-ignore-startenddelta-and-only-use-the" class="section level2">
<h2>‘knows ##’ to ignore <code>start/end/delta</code> and only use the</h2>
</div>
<div id="times-in-add-for-observations." class="section level2">
<h2>’ times in <code>add</code> for observations.</h2>
</div>
</div>
<div id="section-9" class="section level1">
<h1>+</h1>
<p>des &lt;- data_frame(ID=1:2, end=-1, add=list(t1,t2)) des</p>
<p>mod %&gt;% idata_set(des, select=ID) %&gt;% design(as_deslist(des)) %&gt;% mrgsim %&gt;% plot(CP~time|factor(ID), type=‘b’)</p>
<div id="ok-not-the-most-lovely-looking-result-weve-seen-before" class="section level2">
<h2>‘##’ Ok … not the most lovely-looking result we’ve seen before,</h2>
</div>
<div id="but-maybe-thats-just-what-you-needed-in-this-simulation." class="section level2">
<h2>‘but maybe that’s just what you needed in this simulation. ##’</h2>
</div>
</div>
